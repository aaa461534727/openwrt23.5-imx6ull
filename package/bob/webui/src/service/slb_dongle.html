<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
  <meta http-equiv="proma" content="no-cache"/>
  <meta http-equiv="cache-control" content="no cache" />
  <meta http-equiv="expires" content="0" />
  <link rel="shortcut icon" href="/favicon.ico">
  <link href="/static/css/main.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="/static/css/bootstrap-dialog.css">
  <link rel="stylesheet" type="text/css" href="/static/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="/static/css/bootstrap-switch.min.css">
  <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
<div id="app">
  <div id="main">
    <div class="row" v-cloak>
      <!--****填充区******-->
      <section class="col-xs-12">
        <div class="content-box">
          <div class="table-responsive">
		    <table class="table table-striped">
              <tr>
                <td colspan="2"><strong>{{ lang_t('slb_dongle.help') }}</strong></td>
              </tr>
              <tr>
                <td colspan="2">
			            <button class="btn btn-primary" @click="scan" id="scan_ing" :data-loading-text="lang_t('common.scan')" >{{lang_t('common.scan')}}</button>
                </td>
              </tr>
              <tr>
                <td style="width:30%">{{ lang_t('slb_dongle.repeat_state') }}</td>
                <td>
                  <!-- <span style="font-weight:bold">{{ rptSsid }}</span> -->
                  <span v-if="rptConnected == false" style="color: black">{{ lang_t('slb_dongle.connect_fail') }}</span>
                  <span v-if="rptConnected == true" style="color: green">{{ lang_t('slb_dongle.connect') }}</span>
                </td>
              </tr>

            </table>
          </div>
        </div>
      </section>
	  <!-- 热点列表页面 -->
      <div class="modal fade" id="scan_ap_list" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
        <div class="modal-dialog" :style="{width: globalConfig.isPhoneDevice ? 'auto' : '800px'}">
          <div class="modal-content" >
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              <h4>{{ lang_t('slb_dongle.repeat_ap') }}</h4>
            </div>
            <div class="modal-body" style="overflow-x: auto;">
              <table class="table table-striped">
                <thead>
                  <th>{{ lang_t('wifi.channel') }}</th>
                  <th>{{ lang_t('wifi.ssid') }}</th>
                  <!-- <th>{{ lang_t('index.mac') }}</th> -->
                  <th>{{ lang_t('wifi.security_mode') }}</th>
                  <th>{{ lang_t('index.signal') }}</th>
                  <th>{{ lang_t('slb_dongle.cell_id') }}</th> 
                  <th>{{ lang_t('slb_dongle.domain_cnt') }}</th> 
                  <th>{{ lang_t('slb_dongle.vendor_info_cnt') }}</th> 
                </thead>
                <tbody>
                  <tr v-for="(data,v) in aplist" data-dismiss="modal" @click="selectTable(data, v)" style="cursor: pointer;">
                    <td>{{ data.channel }}</td>
                    <td style="white-space:pre;">{{ data.ssid }}</td>
                    <!-- <td>{{ data.bssid }}</td> -->
                    <td>{{ data.encrypt }}</td>
                    <td>{{ data.signal }}</td>
                    <td>{{ data.cell_id }}</td>
                    <td>{{ data.domain_cnt }}</td>
                    <td>{{ data.vendor_info_cnt }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
              <table>
                <tr>
                  <td colspan="12">
                    <button type="button" class="btn btn-default all-but" data-dismiss="modal">{{ lang_t('common.cancel') }}</button>
                  </td>
                </tr>
              </table>
            </div>
          </div>
        </div>
      </div>
<!-- 点击热点列表中的项，弹出配置页面 -->
      <div class="modal fade" id="set_rule" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              <h4 id="myModalLabel">{{ lang_t('slb_dongle.repeat_set') }}</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <tr>
                  <td>{{ lang_t('wifi.ssid') }}</td>
                  <td>
                    <input type="text" v-model="forms.ssid" disabled />
                  </td>
                </tr>

                <tr>
                  <td>{{ lang_t('wifi.security_mode') }}</td>
                  <td>
                    <select disabled v-model="forms.encrypt">
                        <option value="NONE">{{ lang_t('wifi.nosecurity') }}</option>
                        <option value="OPEN">{{ lang_t('wifi.open') }}</option>
                        <option value="SLB">{{ lang_t('wifi.security') }}</option>
                        <option value="WPAPSK">WPA-PSK</option>
                        <option value="WPA2PSK">WPA2-PSK</option>
                        <option value="WPA3PSK">WPA3-PSK</option>
                        <option value="WPAPSKWPA2PSK">WPA/WPA2-PSK</option>
                        <option value="XWLCERT">XWL-CERT</option>
                    </select>
                  </td>
                </tr>

                <tr>
                  <td>{{lang_t('slb_dongle.bw')}}</td>
                  <td>
                    <select v-model="forms.bw">
                      <option v-for="bwOption in bwOptions" :value="bwOption.value" :key="bwOption.value">{{bwOption.option}}</option>
                    </select>
                  </td>  
                </tr>
                <tr>
                  <td>{{ lang_t('slb_dongle.t_channel') }}</td>
                  <td>
                    <select v-model="forms.t_channel">
                      <option v-for="channelOption in channelOptions" :value="channelOption.value" :key="channelOption.value">{{channelOption.option}}</option>
                    </select>
                  </td>  
                </tr>

                <tr v-show="forms.encrypt && (forms.encrypt != 'NONE' && forms.encrypt != 'OPEN')">
                  <td>{{ lang_t('wifi.pass') }}</td>
                  <td>
                    <input type="text" v-model="forms.password" :maxlength="63"/>
                  </td>
                </tr>

              </table>
            </div>
            <div class="modal-footer">
              <table>
                <tr>
                  <td colspan="2">
                    <button type="button" class="btn btn-default all-but" data-dismiss="modal" @click="backListFun">{{ lang_t('common.back') }}</button> &nbsp;&nbsp;
                    <button type="button" class="btn btn-primary all-but" @click="handleSubmit">{{ lang_t('common.connect') }}</button>
                  </td>
                </tr>
              </table>
            </div>
          </div>
        </div>

      </div>
    </div> 
  </div>
</div>
<script src="/plugin/vue.js"></script>
<script src="/plugin/jquery-3.2.1.min.js"></script>
<script src="/plugin/bootstrap.min.js"></script>
<script src="/plugin/bootstrap-switch.min.js"></script>
<script src="/static/js/config.js"></script>
<script src="/static/js/layout.js"></script>
<script src="/static/js/common.js"></script>
<script src="/static/js/topicurl.js"></script>
<script>
var cs_main = {
  template:"#main",
  data:function(){
    return{
      globalConfig:globalConfig,
      lang:$.lang,
      lang_t:lang_t,
      applyLoading: false,
      tableLoading: false,
      selectData: null,
      enable: true,
      enablebak: false,
      forms:{
        channel: '',
        ssid:'',
        bssid: '',
        cipher: '',
        signal: '',
        password: '',
        bw: '',
        t_channel: '',
        wifimode: ''
      },
	    specialChar: globalConfig.specialCharSupport == true ? 'wifichar':'',
      apcliWirelessMode:'',
      clone_mac:'',
      txpower:'',
      wifiIdx:'',
      rptSwitch: false,
      rptConnected: false,
      aplist: []
    }
  },
  computed: {
    toggle_status: function() {
      $('#switch_status').bootstrapSwitch('state', this.enable);
    },
    bwOptions: function(type) {
      return [
        {option: '20M', value: '20'},
        {option: '40M', value: '40'},
        {option: '80M', value: '80'}
      ];
    },
    channelOptions: function(type) {
      return [
        {option: '41', value: '41'},
        {option: '125', value: '125'},
        {option: '209', value: '209'},
        {option: '291', value: '291'},
        {option: '375', value: '375'},
        {option: '459', value: '459'},
        {option: '541', value: '541'},
        {option: '625', value: '625'},
        {option: '709', value: '709'},
        {option: '791', value: '791'},
        {option: '1375', value: '1375'},
        {option: '1459', value: '1459'},
        {option: '1541', value: '1541'},
        {option: '1625', value: '1625'},
        {option: '1709', value: '1709'},
        {option: '1791', value: '1791'},
        {option: '1875', value: '1875'},
        {option: '1959', value: '1959'},
        {option: '2041', value: '2041'},
        {option: '2125', value: '2125'},
        {option: '2209', value: '2209'},
        {option: '2291', value: '2291'},
        {option: '2479', value: '2479'},
        {option: '2563', value: '2563'},
        {option: '2645', value: '2645'},
        {option: '2729', value: '2729'},
        {option: '2813', value: '2813'}           
      ];
    }
  },
  created:function(){
    var _this = this;
    uiPost.getSLBstatus(function(data) {
      if('On' == data.rptSwitch){
        _this.rptSwitch=true;
        _this.rptSsid=data.apcliSsid;
      }else{
        _this.rptSwitch=false;
      }

      if('success' == data.rptConnStatus){
        _this.rptConnected = true;
      }else{
        _this.rptConnected = false;
      }

      _this.clone_mac = data.cloneMac;
      _this.txpower = data.txPower;
      _this.apcliWirelessMode = data.wifiMode;
      _this.wifiIdx = data.wifiIdx_rpt;
    });

  },
  methods:{
    handleSubmit:function(){      
      var _this = this;
      var time = 30;
      var postVar = {};	  
      postVar.channel_rpt = _this.forms.channel;
      postVar.ssid_rpt = _this.forms.ssid;
      postVar.bssid_rpt = _this.forms.bssid;
      postVar.encrypt_rpt = _this.forms.encrypt;
      postVar.cipher_rpt = _this.forms.cipher;
      postVar.password_rpt = _this.forms.password;
      postVar.wifimode_rpt = _this.apcliWirelessMode;
      postVar.bw_rpt = _this.forms.bw;
      postVar.t_channel_rpt = _this.forms.t_channel;
      postVar.index_rpt = _this.forms.index;
      postVar.wifiIdx_rpt = "1";
      if(_this.forms.encrypt && _this.forms.encrypt != 'NONE' && _this.forms.encrypt != 'OPEN'){
        if (!_this.forms.password || _this.forms.password.length < 8) {
          Cstools.msg({
            content: _this.lang_t('wifi.msg4'),
            type: 'error',
            messgetype: 'alert'
          });
          return false;
        }
        if (1 == cs.string(_this.forms.password,_this.specialChar)) {
          Cstools.msg({
            content: _this.lang_t( globalConfig.specialCharSupport==true ? 'wifi.msg8' : 'wifi.msg5'),
            type: 'error',
            messgetype: 'alert'
          });
          return false;
        }
      }
      Cstools.count(time,'js',function(){
          location.href=location.href;
        });
      uiPost.setSLBModeCfg(postVar,function(data) {
      });
    },
    scan:function() {
      $("#scan_ing").button('loading');
      var postVar = {};
      this.getAPlist(postVar);
    },
    getAPlist:function(postVar){
      var _this = this;
      this.tableLoading = true;
      uiPost.getSLBApcliScan(postVar,function(data){
        _this.tableLoading = false;
        _this.aplist = data;
        $('#scan_ap_list').modal('show');
        $("#scan_ing").button('reset');
      })
    },
    rank: function(a,b,type,str){
      var n=m=k=l=0;
      if(str == "ip"){
        n = Number(a.split('.')[2]);
        m = Number(b.split('.')[2]);
        k = Number(a.split('.')[3]);
        l = Number(b.split('.')[3]);
      }else if(str == "num"){
        n = Number(a);
        m = Number(b);
      }else{
        n = a;
        m = b;
      }
      if(type == 'asc'){
        if(n > m){
          return 1;
        }else if(n == m && str == "ip"){
          return k > l ? 1 : -1;
        }else if(n < m){
          return -1;
        }
      }else{
        if(n > m){
          return -1;
        }else if(n == m && str == "ip"){
          return k > l ? -1 : 1;
        }else if(n < m){
          return 1;
        }
      }
    },
    selectTable: function(val, index) {
      this.wifiIdx = val.wifiIdx;
      this.selectData = val;
      this.forms = val;
      this.forms.bw = '20'; // 频宽默认20
      this.forms.t_channel = '2813'; // T点信道默认2813
      this.forms.index = index;
      $('#set_rule').modal('show');
      cs.bodyAction('scan_ap_list','set_rule');
    },
    backListFun:function(){
      $('#scan_ap_list').modal('show');
      cs.bodyAction('set_rule','scan_ap_list');
    }
  },
  mounted:function(){
    var _this = this;
    addSwitch('#switch_status', function(data){
      if(_this.enable == false && data){
        _this.enable = data;
        _this.submit_status();
      }
      if(_this.enable && data == false){
        _this.enable = data;
        _this.submit_status();
      }
    })
  }
};
</script>
<script src="/static/js/main.js"></script>
</body>
</html>  